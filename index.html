<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>B√°o C√°o Doanh Thu C∆°m N·∫•m</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
        
        body {
            background-color: #f3f4f6;
            font-family: 'Quicksand', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        
        /* B√ÅO C√ÅO T·ªêI ∆ØU MOBILE - CH·ªêNG D√çNH CH·ªÆ */
        #capture-area {
            background: #ffffff;
            padding: 35px 20px;
            color: #1f2937;
            min-width: 360px;
        }
        .report-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px dashed #e5e7eb;
            padding-bottom: 20px;
        }
        .report-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: #111827;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }
        .report-info {
            font-size: 0.95rem;
            color: #6b7280;
            font-style: italic;
        }

        /* C·∫•u tr√∫c d√≤ng s·∫£n ph·∫©m */
        .report-row {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        .report-header-row {
            display: flex;
            padding: 15px 0 10px 0;
            font-size: 11px;
            font-weight: 700;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .col-name { flex: 1; min-width: 0; padding-right: 10px; }
        .col-qty { width: 125px; flex-shrink: 0; display: flex; justify-content: center; }
        .col-price { width: 95px; flex-shrink: 0; text-align: right; }

        /* C·ª•m Nh·∫≠p/B√°n/D∆∞ th·∫≥ng h√†ng tuy·ªát ƒë·ªëi */
        .qty-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        .qty-box { width: 32px; text-align: center; font-weight: 700; font-size: 14px; }
        .qty-sep { width: 12px; text-align: center; color: #cbd5e1; font-size: 12px; }
        .qty-in { color: #94a3b8; font-weight: 500; }
        .qty-sold { color: #111827; font-weight: 800; font-size: 15px; }
        .qty-rem { color: #f97316; }

        /* Ph·∫ßn t·ªïng k·∫øt - S·ª≠a l·ªói d√≠nh ch·ªØ */
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
        }
        .summary-label {
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
        }
        .summary-value {
            font-size: 14px;
            font-weight: 700;
            color: #1f2937;
            margin-left: 20px; /* T·∫°o kho·∫£ng c√°ch an to√†n */
        }
        .summary-total-label {
            font-size: 12px;
            font-weight: 800;
            color: #2563eb;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .summary-total-value {
            font-size: 18px;
            font-weight: 800;
            color: #2563eb;
        }

        /* Khu v·ª±c ti·ªÅn m·∫∑t cu·ªëi c√πng n·ªïi b·∫≠t */
        .final-cash-box {
            margin-top: 25px;
            background: #f8fafc;
            padding: 20px;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            text-align: center;
        }
        .final-cash-label {
            display: block;
            font-size: 10px;
            font-weight: 800;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }
        .final-cash-amount {
            font-size: 32px;
            font-weight: 900;
            color: #059669; /* M√†u xanh l√° ƒë·∫≠m chuy√™n nghi·ªáp */
            display: block;
        }

    </style>
</head>
<body class="p-4 md:p-8 flex justify-center">
    <div class="w-full max-w-lg">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 tracking-tight">C∆†M N·∫§M <span class="text-orange-500">PRO</span></h1>
            <p class="text-gray-400 text-sm">H·ªá th·ªëng qu·∫£n l√Ω b√°o c√°o chuy√™n nghi·ªáp</p>
        </div>

        <!-- Nh·∫≠p li·ªáu -->
        <div class="card p-6 mb-6 space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Chi nh√°nh</label>
                    <input type="text" id="branch" class="w-full p-3 border border-gray-100 bg-gray-50 rounded-xl outline-none" value="CN8">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Bu·ªïi b√°n</label>
                    <input type="text" id="shift" class="w-full p-3 border border-gray-100 bg-gray-50 rounded-xl outline-none">
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-blue-500 uppercase mb-1">Ti·ªÅn k√©t ƒë·∫ßu (ƒë)</label>
                    <input type="number" id="cashBox" class="w-full p-3 border border-blue-50 bg-blue-50/30 rounded-xl font-bold text-blue-700 outline-none" value="260000">
                </div>
                <div>
                    <label class="block text-xs font-bold text-purple-500 uppercase mb-1">Chuy·ªÉn kho·∫£n (ƒë)</label>
                    <input type="number" id="bankTransfer" class="w-full p-3 border border-purple-50 bg-purple-50/30 rounded-xl font-bold text-purple-700 outline-none" value="0">
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-red-500 uppercase mb-1">Chi ph√≠ ph√°t sinh (ƒë)</label>
                <input type="number" id="totalExpense" class="w-full p-3 border border-red-50 bg-red-50/30 rounded-xl font-bold text-red-700 outline-none" value="0">
            </div>
        </div>

        <!-- Danh s√°ch nh·∫≠p s·ªë l∆∞·ª£ng -->
        <div class="card p-6 mb-6">
            <h2 class="font-bold text-gray-800 uppercase text-xs mb-4 border-b pb-2">ƒêi·ªÅu ch·ªânh s·ªë l∆∞·ª£ng</h2>
            <div id="product-container" class="space-y-4"></div>
        </div>

        <button onclick="calculate()" class="w-full bg-gray-900 text-white font-bold py-5 rounded-2xl shadow-xl active:scale-95 transition-all mb-10 text-lg">
            XU·∫§T B√ÅO C√ÅO NGAY üìä
        </button>

        <!-- B√ÅO C√ÅO HI·ªÇN TH·ªä ƒê·ªÇ CH·ª§P ·∫¢NH -->
        <div id="report-section" class="hidden">
            <div id="capture-area" class="card shadow-none border border-gray-100">
                <div class="report-header">
                    <h3 class="report-title">B√ÅO C√ÅO DOANH THU</h3>
                    <div id="res-info" class="report-info"></div>
                </div>
                
                <div class="report-header-row">
                    <div class="col-name">M√≥n ƒÉn</div>
                    <div class="col-qty">Nh·∫≠p / B√°n / D∆∞</div>
                    <div class="col-price">Th√†nh ti·ªÅn</div>
                </div>

                <div id="res-body"></div>

                <div class="mt-8 pt-6 border-t-2 border-gray-50 space-y-2">
                    <div class="summary-item">
                        <span class="summary-total-label">T·ªïng doanh thu:</span>
                        <span id="res-revenue" class="summary-total-value">0ƒë</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Ti·ªÅn k√©t ƒë·∫ßu bu·ªïi (+):</span>
                        <span id="res-cashbox-view" class="summary-value">0ƒë</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label" style="color: #9333ea;">Chuy·ªÉn kho·∫£n (-):</span>
                        <span id="res-transfer" class="summary-value" style="color: #9333ea;">0ƒë</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label" style="color: #ef4444;">Chi ph√≠ ph√°t sinh (-):</span>
                        <span id="res-expense" class="summary-value" style="color: #ef4444;">0ƒë</span>
                    </div>
                    
                    <div class="final-cash-box">
                        <span class="final-cash-label">S·ªë ti·ªÅn m·∫∑t th·ª±c thu</span>
                        <span id="res-cash" class="final-cash-amount">0ƒë</span>
                    </div>
                </div>
                
                <div class="mt-10 flex justify-between items-center text-[9px] text-gray-300 font-bold uppercase tracking-widest">
                    <span>H·ªá th·ªëng t·ª± ƒë·ªông Pro</span>
                    <span id="res-time"></span>
                </div>
            </div>

            <button onclick="downloadImage()" class="mt-6 w-full bg-emerald-500 text-white font-bold py-5 rounded-xl shadow-lg mb-20 text-lg">
                üíæ T·∫¢I ·∫¢NH G·ª¨I B√ÅO C√ÅO
            </button>
        </div>
    </div>

    <script>
        const products = [
            { id: "bo_ham", name: "C∆°m n·∫Øm b√≤ h·∫ßm ü•©", price: 23000 },
            { id: "ca_hoi", name: "C∆°m n·∫Øm c√° h·ªìi üç£", price: 22000 },
            { id: "ca_ngu", name: "C∆°m n·∫Øm c√° ng·ª´ üêü", price: 20000 },
            { id: "ga_mayo", name: "C∆°m n·∫Øm g√† mayo üçó", price: 18000 },
            { id: "ga_phomai", name: "C∆°m n·∫Øm g√† ph√¥ mai üçóüßÄ", price: 22000 },
            { id: "trung_cha_bong", name: "C∆°m n·∫Øm tr·ª©ng ch√† b√¥ng ü•ö", price: 16000 }
        ];
        const state = {};

        function getToday() {
            const d = new Date();
            return `${d.getDate()}/${d.getMonth() + 1}/${d.getFullYear()}`;
        }

        function init() {
            const container = document.getElementById('product-container');
            products.forEach(p => {
                state[p.id] = { stock: 0, sold: 0 };
                const div = document.createElement('div');
                div.className = "flex items-center justify-between bg-gray-50/50 p-3 rounded-xl border border-gray-50";
                div.innerHTML = `
                    <div class="flex-1">
                        <p class="font-bold text-gray-800 text-sm">${p.name}</p>
                        <p class="text-[10px] font-bold text-gray-400">${p.price.toLocaleString()}ƒë</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="flex flex-col items-center">
                           <span class="text-[8px] font-bold text-gray-400 uppercase mb-1">Nh·∫≠p</span>
                           <input type="number" oninput="updateStock('${p.id}', this.value)" 
                               class="w-10 p-1 text-center border-b-2 border-gray-200 focus:border-orange-400 outline-none font-bold text-sm bg-transparent" placeholder="0">
                        </div>
                        <div class="flex flex-col items-center">
                            <span class="text-[8px] font-bold text-gray-400 uppercase mb-1">B√°n</span>
                            <div class="flex items-center gap-2 bg-white p-1 rounded-lg shadow-sm border border-gray-100">
                                <button onclick="updateSold('${p.id}', -1)" class="w-7 h-7 bg-red-500 text-white rounded-md font-bold">-</button>
                                <span id="sold-${p.id}" class="w-5 text-center font-bold text-sm text-gray-700">0</span>
                                <button onclick="updateSold('${p.id}', 1)" class="w-7 h-7 bg-emerald-500 text-white rounded-md font-bold">+</button>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
            document.getElementById('shift').value = "S√°ng " + getToday();
        }

        function updateStock(id, val) { state[id].stock = parseInt(val) || 0; }
        function updateSold(id, delta) {
            state[id].sold = Math.max(0, state[id].sold + delta);
            document.getElementById(`sold-${id}`).innerText = state[id].sold;
        }

        function formatMoney(num) {
            return num.toLocaleString('vi-VN') + 'ƒë';
        }

        function calculate() {
            let total = 0;
            const resBody = document.getElementById('res-body');
            const cashBox = parseInt(document.getElementById('cashBox').value) || 0;
            const bank = parseInt(document.getElementById('bankTransfer').value) || 0;
            const exp = parseInt(document.getElementById('totalExpense').value) || 0;
            
            resBody.innerHTML = '';
            
            products.forEach(p => {
                const { stock, sold } = state[p.id];
                const remain = Math.max(0, stock - sold);
                const subtotal = sold * p.price;
                total += subtotal;

                if(stock > 0 || sold > 0) {
                    const row = document.createElement('div');
                    row.className = "report-row";
                    row.innerHTML = `
                        <div class="col-name font-semibold text-gray-700 text-[13px]">${p.name}</div>
                        <div class="col-qty">
                            <div class="qty-container">
                                <div class="qty-box qty-in">${stock}</div>
                                <div class="qty-sep">/</div>
                                <div class="qty-box qty-sold">${sold}</div>
                                <div class="qty-sep">/</div>
                                <div class="qty-box qty-rem">${remain}</div>
                            </div>
                        </div>
                        <div class="col-price font-bold text-gray-900 text-[14px]">${formatMoney(subtotal)}</div>
                    `;
                    resBody.appendChild(row);
                }
            });

            document.getElementById('res-info').innerText = `${document.getElementById('branch').value} | ${document.getElementById('shift').value}`;
            document.getElementById('res-revenue').innerText = formatMoney(total);
            document.getElementById('res-cashbox-view').innerText = formatMoney(cashBox);
            document.getElementById('res-transfer').innerText = formatMoney(bank);
            document.getElementById('res-expense').innerText = formatMoney(exp);
            document.getElementById('res-time').innerText = new Date().toLocaleTimeString('vi-VN') + ' ' + getToday();
            
            const final = (total + cashBox) - bank - exp;
            document.getElementById('res-cash').innerText = formatMoney(final);

            document.getElementById('report-section').classList.remove('hidden');
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        async function downloadImage() {
            const el = document.getElementById('capture-area');
            const canvas = await html2canvas(el, { 
                scale: 3, 
                backgroundColor: "#ffffff",
                useCORS: true 
            });
            const link = document.createElement('a');
            link.download = `BaoCao_${document.getElementById('branch').value}_${getToday().replace(/\//g,'-')}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        }

        window.onload = init;
    </script>
</body>
</html>
