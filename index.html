<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°o C√°o Doanh Thu C∆°m n·∫Øm üçô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
        body { background-color: #f8fafc; font-family: 'Quicksand', sans-serif; }
        .card { background: white; border-radius: 24px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); }
        .input-label { font-size: 11px; font-weight: 700; text-transform: uppercase; margin-left: 4px; margin-bottom: 6px; display: block; letter-spacing: 0.5px; }
        .input-field { width: 100%; padding: 12px 16px; background-color: #f1f5f9; border-radius: 12px; outline: none; border: 2px solid transparent; font-weight: 600; }
        .input-field:focus { border-color: #e2e8f0; background-color: #fff; }
        .btn-control { color: white; width: 32px; height: 32px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: none; cursor: pointer; }
        .btn-plus { background-color: #10b981; }
        .btn-minus { background-color: #f43f5e; }
        #capture-area { background: #ffffff; padding: 40px 30px; border-radius: 24px; }
        .report-header-row { display: flex; padding: 15px 0; border-bottom: 1.5px solid #f1f5f9; font-size: 11px; font-weight: 800; color: #94a3b8; text-transform: uppercase; }
        .report-row { display: flex; align-items: center; padding: 16px 0; border-bottom: 1px solid #f8fafc; }
        .col-name { flex: 1.2; text-align: left; }
        .col-qty { flex: 1.5; display: flex; justify-content: center; }
        .col-price { flex: 0.8; text-align: right; }
        .qty-container { display: flex; align-items: center; width: 115px; justify-content: space-between; font-weight: 700; }
        .qty-sold { color: #1e293b; font-weight: 800; font-size: 1.1rem; }
        .summary-line { display: flex; justify-content: space-between; padding: 8px 0; font-weight: 600; font-size: 14px; color: #64748b; }
        .summary-total { font-weight: 800; color: #1e293b; font-size: 18px; text-transform: uppercase; margin-top: 15px; }
    </style>
</head>
<body class="p-4 md:p-8 flex justify-center">
    <div class="w-full max-w-lg">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-slate-800 tracking-tight">C∆†M n·∫Øm NH√Ä MON üçô</h1>
        </div>

        <div class="card p-6 mb-6">
            <div class="grid grid-cols-2 gap-5 mb-5">
                <div>
                    <label class="input-label text-slate-500">Chi nh√°nh</label>
                    <input type="text" id="branch" class="input-field text-slate-700" placeholder="CN8">
                </div>
                <div>
                    <label class="input-label text-slate-500">Bu·ªïi b√°n</label>
                    <input type="text" id="shift" class="input-field text-slate-700">
                </div>
            </div>
            <div class="grid grid-cols-2 gap-5 mb-5">
                <div>
                    <label class="input-label text-blue-500">Ti·ªÅn k√©t ƒë·∫ßu bu·ªïi (+)</label>
                    <input type="number" id="cashBox" class="input-field text-blue-600 font-bold" value="0">
                </div>
                <div>
                    <label class="input-label text-purple-500">Chuy·ªÉn kho·∫£n (-)</label>
                    <input type="number" id="bankTransfer" class="input-field text-purple-600 font-bold" value="0">
                </div>
            </div>
            <div>
                <label class="input-label text-red-500">Chi ph√≠ ph√°t sinh (-)</label>
                <input type="number" id="totalExpense" class="input-field text-red-600 font-bold" value="0">
            </div>
        </div>

        <div class="card p-6 mb-6">
            <label class="input-label text-slate-400 mb-4">S·ªë l∆∞·ª£ng s·∫£n ph·∫©m</label>
            <div id="product-container" class="space-y-6"></div>
        </div>

        <div class="flex gap-3 mb-10">
            <button onclick="calculate()" id="btn-calc" class="flex-[3] bg-slate-900 text-white font-bold py-5 rounded-2xl shadow-lg hover:bg-black transition">XU·∫§T B√ÅO C√ÅO üìä</button>
            <button onclick="resetData()" class="flex-1 bg-red-50 text-red-500 font-bold rounded-2xl border-2 border-red-100">X√≥a</button>
        </div>

        <div id="report-section" class="hidden">
            <div id="capture-area" class="card">
                <div class="text-center mb-8">
                    <h3 class="font-black text-2xl uppercase tracking-tight text-slate-900">B√°o C√°o Doanh Thu</h3>
                    <div id="res-info" class="text-slate-400 font-bold text-sm mt-1"></div>
                </div>
                <div class="report-header-row">
                    <div class="col-name">M√≥n ƒÉn</div>
                    <div class="col-qty">Nh·∫≠p / B√°n / D∆∞</div>
                    <div class="col-price">Th√†nh ti·ªÅn</div>
                </div>
                <div id="res-body"></div>
                <div class="mt-6 pt-4">
                    <div class="summary-line summary-total"><span>T·ªïng doanh thu</span><span id="sum-revenue">0ƒë</span></div>
                    <div class="summary-line mt-2"><span>Ti·ªÅn k√©t ƒë·∫ßu bu·ªïi (+)</span><span id="sum-cashbox" class="text-slate-900">0ƒë</span></div>
                    <div class="summary-line"><span>Chuy·ªÉn kho·∫£n (-)</span><span id="sum-bank" class="text-slate-900">0ƒë</span></div>
                    <div class="summary-line"><span class="text-red-500 font-bold uppercase text-[11px]">Chi ph√≠ ph√°t sinh (-)</span><span id="sum-expense" class="text-red-500 font-bold">0ƒë</span></div>
                </div>
                <div class="mt-10 bg-slate-900 p-8 rounded-[2rem] text-center shadow-2xl">
                    <span class="text-slate-400 text-[10px] font-black uppercase tracking-[0.2em]">Ti·ªÅn m·∫∑t</span><br>
                    <span id="res-cash" class="text-5xl font-black text-white">0ƒë</span>
                </div>
            </div>
            <button onclick="downloadImage()" class="mt-6 w-full bg-orange-500 text-white font-bold py-4 rounded-2xl shadow-lg hover:bg-orange-600 transition">üíæ T·∫¢I ·∫¢NH B√ÅO C√ÅO</button>
        </div>
    </div>

    <script>
        const products = [
            { id: "bo_ham", name: "C∆°m n·∫Øm b√≤ h·∫ßm ü•©", price: 23000 },
            { id: "ca_hoi", name: "C∆°m n·∫Øm c√° h·ªìi üç£", price: 22000 },
            { id: "ca_ngu", name: "C∆°m n·∫Øm c√° ng·ª´ üêü", price: 20000 },
            { id: "ga_mayo", name: "C∆°m n·∫Øm g√† mayo üçó", price: 18000 },
            { id: "ga_phomai", name: "C∆°m n·∫Øm g√† ph√¥ mai üçóüßÄ", price: 22000 },
            { id: "trung_cha_bong", name: "C∆°m n·∫Øm tr·ª©ng ch√† b√¥ng ü•ö", price: 16000 }
        ];

        let state = JSON.parse(localStorage.getItem('comNamMonState')) || {};

        function getToday() {
            const d = new Date();
            return `S√°ng ${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${d.getFullYear()}`;
        }

        function init() {
            const container = document.getElementById('product-container');
            container.innerHTML = ''; 
            
            products.forEach(p => {
                if(!state[p.id]) state[p.id] = { stock: 0, sold: 0 };
                const div = document.createElement('div');
                div.className = "flex items-center justify-between";
                div.innerHTML = `
                    <div class="flex-1">
                        <p class="font-bold text-[15px] text-slate-800">${p.name}</p>
                        <p class="text-[11px] font-bold text-slate-400">${p.price.toLocaleString()}ƒë</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <input type="number" value="${state[p.id].stock}" onchange="updateStock('${p.id}', this.value)" 
                            class="w-12 text-center border-b-2 border-transparent focus:border-orange-400 outline-none font-bold bg-slate-50 p-1 rounded-lg">
                        <div class="flex items-center gap-2 bg-slate-100 p-1 rounded-xl">
                            <button onclick="updateSold('${p.id}', -1)" class="btn-control btn-minus shadow-sm">-</button>
                            <span id="sold-${p.id}" class="w-6 text-center font-black text-slate-700">${state[p.id].sold}</span>
                            <button onclick="updateSold('${p.id}', 1)" class="btn-control btn-plus shadow-sm">+</button>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });

            document.getElementById('branch').value = localStorage.getItem('monBranch') || "CN8";
            document.getElementById('cashBox').value = localStorage.getItem('monCashBox') || 0;
            document.getElementById('bankTransfer').value = localStorage.getItem('monBank') || 0;
            document.getElementById('totalExpense').value = localStorage.getItem('monExp') || 0;
            document.getElementById('shift').value = localStorage.getItem('monShift') || getToday();

            ['branch', 'cashBox', 'bankTransfer', 'totalExpense', 'shift'].forEach(id => {
                document.getElementById(id).oninput = saveData;
            });
        }

        function saveData() {
            localStorage.setItem('comNamMonState', JSON.stringify(state));
            localStorage.setItem('monBranch', document.getElementById('branch').value);
            localStorage.setItem('monCashBox', document.getElementById('cashBox').value);
            localStorage.setItem('monBank', document.getElementById('bankTransfer').value);
            localStorage.setItem('monExp', document.getElementById('totalExpense').value);
            localStorage.setItem('monShift', document.getElementById('shift').value);
        }

        function updateStock(id, val) { 
            state[id].stock = parseInt(val) || 0; 
            saveData(); 
        }
        
        function updateSold(id, delta) {
            state[id].sold = Math.max(0, (state[id].sold || 0) + delta);
            document.getElementById(`sold-${id}`).innerText = state[id].sold;
            saveData();
        }

        function calculate() {
            let totalRevenue = 0;
            const resBody = document.getElementById('res-body');
            resBody.innerHTML = '';
            
            products.forEach(p => {
                const s = state[p.id] || { stock: 0, sold: 0 };
                const subtotal = s.sold * p.price;
                totalRevenue += subtotal;
                
                if(s.stock > 0 || s.sold > 0) {
                    resBody.innerHTML += `
                        <div class="report-row">
                            <div class="col-name text-[13px] font-bold text-slate-700">${p.name}</div>
                            <div class="col-qty">
                                <div class="qty-container">
                                    <div class="qty-box text-slate-300">${s.stock}</div>
                                    <div class="text-slate-100">/</div>
                                    <div class="qty-box qty-sold">${s.sold}</div>
                                    <div class="text-slate-100">/</div>
                                    <div class="qty-box text-orange-500 font-black">${s.stock - s.sold}</div>
                                </div>
                            </div>
                            <div class="col-price font-black text-slate-900 text-[14px]">${subtotal.toLocaleString()}ƒë</div>
                        </div>`;
                }
            });

            const cb = parseInt(document.getElementById('cashBox').value) || 0;
            const bt = parseInt(document.getElementById('bankTransfer').value) || 0;
            const ex = parseInt(document.getElementById('totalExpense').value) || 0;
            
            document.getElementById('sum-revenue').innerText = totalRevenue.toLocaleString() + 'ƒë';
            document.getElementById('sum-cashbox').innerText = cb.toLocaleString() + 'ƒë';
            document.getElementById('sum-bank').innerText = bt.toLocaleString() + 'ƒë';
            document.getElementById('sum-expense').innerText = ex.toLocaleString() + 'ƒë';
            
            const finalCash = (totalRevenue + cb) - bt - ex;
            document.getElementById('res-cash').innerText = finalCash.toLocaleString() + 'ƒë';
            document.getElementById('res-info').innerText = document.getElementById('branch').value + " ‚Ä¢ " + document.getElementById('shift').value;
            
            document.getElementById('report-section').classList.remove('hidden');
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        function resetData() {
            if(confirm("X√≥a to√†n b·ªô d·ªØ li·ªáu hi·ªán t·∫°i?")) {
                localStorage.clear();
                location.reload();
            }
        }

        async function downloadImage() {
            const area = document.getElementById('capture-area');
            const canvas = await html2canvas(area, { scale: 3, backgroundColor: "#ffffff" });
            const link = document.createElement('a');
            link.download = `B√°o_C√°o_${document.getElementById('branch').value}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        }

        window.onload = init;
    </script>
</body>
</html>